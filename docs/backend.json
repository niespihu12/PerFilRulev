{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the PerFinRule application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's display name."
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction (income or expense).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Transaction)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction."
        },
        "date": {
          "type": "string",
          "description": "The date of the transaction.",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "description": "The category of the transaction (Needs, Wants, Savings)."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction."
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "date",
        "category"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The 'userId' parameter is the unique identifier for the user, matching the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction data for each user. Path-based ownership ensures that a user can only access transactions under their own user ID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user who owns the transaction."
            },
            {
              "name": "transactionId",
              "description": "Unique identifier for the transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data security and follows the principle of authorization independence. Each user has their own collection of transactions, ensuring they can only access their own data. The `userId` field within the `transactions` collection is present for data consistency. No denormalization is needed since access to the transactions is determined by the path.  The path-based ownership enables efficient and secure `list` operations, thus supporting QAPs.  A naming convention helps maintain a consistent and predictable structure."
  }
}